
module_config = config['RdTest']

def rdtest_bed(wildcards):
    if wildcards.source == 'depth':
        return 'integration/depth/rdtest_beds/cohort.{chrom}.bed'
    else:
        return 'integration/pesr/rdtest_beds/{source}/merged.{{chrom}}.bed'.format(wildcards.source)

rule RdTest:
    input:
        bed=rdtest_bed
    output:
        pk='rdtest/{source}/cohort.{chrom}.bed.pk',
        zrank='rdtest/{source}/cohort.{chrom}.bed_HomPowerPZRank.txt',
    shell:
        """
        cp {input.bed} {output.pk};
        cp {input.bed} {output.zrank};
        """
        # """
        # Rscript {module_config[gt_script]} -b {input.bed} \
        #   -c {module_config[bincov]} \
        #   -o cohort.{wildcards.chrom}.bed -v TRUE -g NULL \
        #   -j rdtest/{wildcards.source}/ > /dev/null;
        # """

rule rdtest_filter:
    input:
        zrank='rdtest/{source}/cohort.{chrom}.bed_HomPowerPZRank.txt',
    output:
        'rdtest/{source}/cohort.rdtest_pass.{chrom}.list'
    shell:
        """
        sed '1d' {input} | cut -f4 > {output}
        """
    

# rule make_pk_list:
#     input:
#         expand('data/genotyping/{vs}.bed.pk', vs=variants)
#     output:
#         'scratch/reassigned.pk.list'
#     run:
#         with open(output[0], 'w') as fout:
#             for fname in input:
#                 fout.write(fname + '\n')
# 
# 
# rule merge_pk: 
#     input:
#         'scratch/reassigned.pk.list'
#     output:
#         'data/gt_results/reassigned.pk'
#     shell:
#         """
#         cat {input} \
#           | xargs cat \
#           | sed -e '/^Chr/d' \
#           | sort -k1,1V -k2,2n \
#           | uniq \
#           | cat <(head -n1 {input} | xargs cat | head -n1) - \
#           > {output}
#         """
# 
# rule gt_filter:
#     input:
#         'data/gt_results/reassigned.pk'
#     output:
#         'data/gt_results/reassigned.gt_filter.pk'
#     shell:
#         """
#         ./scripts/gt_filter.py {input} > {output}
#         """
# 
